# üõí WB-API Microservice

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ –±–∞–∑–µ [NestJS](https://nestjs.com/) –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö —Å WildBerries. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ gRPC —Å–µ—Ä–≤–µ—Ä –¥–ª—è Product-Filter-Service.

## üì¶ –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å WildBerries. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Product-Filter-Service.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **gRPC —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Product-Filter-Service
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π** —á–µ—Ä–µ–∑ xsubject –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ç–æ–ª—å–∫–æ –ø–∞—Ä—Å–∏–Ω–≥, –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Product-Filter-Service (gRPC Client) ‚Üí WB-API (gRPC Server) ‚Üí WildBerries API
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **gRPC Server** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Product-Filter-Service
- **WB Parser Service** - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å WildBerries
- **WB API Client** - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ WildBerries

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **gRPC —Å–µ—Ä–≤–µ—Ä**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Product-Filter-Service
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ**: –í–æ–∑–≤—Ä–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å WildBerries
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**: –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ xsubject –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ú–∏–Ω–∏–º—É–º –∫–æ–¥–∞, –º–∞–∫—Å–∏–º—É–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üì° gRPC API

### GetRawProducts
```protobuf
rpc GetRawProducts(GetRawProductsRequest) returns (GetRawProductsResponse)

message GetRawProductsRequest {
  string query = 1;
  string category = 2; // xsubject ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, "3274" –¥–ª—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç)
  string platform_id = 3; // ID –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
- **–í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã**: `query: "rtx 5070", category: "3274"`
- **–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã**: `query: "7800x3d", category: "3698"`
- **–ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–µ –ø–ª–∞—Ç—ã**: `query: "z790", category: "3690"`

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 18
- npm
- gRPC –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Framework**: [NestJS](https://nestjs.com/) - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π Node.js —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Language**: [TypeScript](https://www.typescriptlang.org/) - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **gRPC**: @grpc/grpc-js, @grpc/proto-loader - –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
- **HTTP Client**: Fetch API - –∑–∞–ø—Ä–æ—Å—ã –∫ WildBerries API

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.ts                           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ app.module.ts                     # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ grpc-server/                      # gRPC —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ grpc-server.service.ts       # gRPC —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ parser/                           # –ü–∞—Ä—Å–µ—Ä WildBerries
‚îÇ   ‚îî‚îÄ‚îÄ wb-parser.service.ts         # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä
‚îú‚îÄ‚îÄ types/                            # –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ raw-product.interface.ts     # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îî‚îÄ‚îÄ wb-api.client.ts                 # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è WB API
```

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã WB API

### WB xsubject –∑–Ω–∞—á–µ–Ω–∏—è (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤)

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è xsubject –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Wildberries API:**

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | xsubject | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| **–í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã** | `3274` | –í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã –∏ GPU –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤ |
| **–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã** | `3698` | CPU –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã –¥–ª—è –ü–ö |
| **–ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–µ –ø–ª–∞—Ç—ã** | `3690` | –ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–µ –ø–ª–∞—Ç—ã –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–ª–∞—Ç—ã |
| **PlayStation** | `8829` | –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å–æ–ª–∏ PlayStation |
| **Nintendo Switch** | `523` | –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å–æ–ª–∏ Nintendo |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```typescript
// –í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã
const xsubject = 3274;

// –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã
const xsubject = 3698;

// –ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–µ –ø–ª–∞—Ç—ã
const xsubject = 3690;
```

### –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ WB

```
https://search.wb.ru/exactmatch/ru/common/v13/search?query=rtx4070&xsubject=3274&sort=priceup

https://search.wb.ru/exactmatch/ru/common/v13/search?query=7800x3d&xsubject=3698&sort=priceup
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è Wildberries API –∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ WB –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Product-Filter-Service.

---

## üê≥ Docker –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f wb-api
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–µ—Ä–≤–∏—Å–∞:**
   ```sh
   cd monorepo-root/wb-api
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```sh
   npm install
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
   ```sh
   npm run start:dev
   ```
   gRPC —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000.

4. **–ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Ä–µ–∂–∏–º–µ:**
   ```sh
   npm run build
   npm run start:prod
   ```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ gRPC —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ grpcurl
# Windows: choco install grpcurl
# Linux: apt install grpcurl

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
grpcurl -plaintext localhost:3000 list

# –¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
grpcurl -plaintext -d '{"query":"rtx4070","category":"3274"}' \
  localhost:3000 raw_product.RawProductService/GetRawProducts
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Product-Filter-Service

```bash
# –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π API
curl "http://localhost:3001/api/products?query=RTX4070&category=videocards"
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# Docker
docker-compose logs -f wb-api

# –õ–æ–∫–∞–ª—å–Ω–æ
npm run start:dev
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ gRPC —Å–µ—Ä–≤–µ—Ä–∞
grpcurl -plaintext localhost:3000 list
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| `gRPC UNAVAILABLE` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000 |
| `WB API error` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å WildBerries |
| `Invalid xsubject` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å category –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |
| `Container –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs wb-api` |
| `Build failed` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
- –í—Å–µ –ª–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: INFO
- –§–æ—Ä–º–∞—Ç: `üîç WB API: {query} ({category})`

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

---

## üîÑ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

1. –î–æ–±–∞–≤—å—Ç–µ xsubject –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Product-Filter-Service
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ gRPC –∑–∞–ø—Ä–æ—Å
3. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

1. –û–±–Ω–æ–≤–∏—Ç–µ proto —Ñ–∞–π–ª
2. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–æ–¥
3. –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ Redis
docker-compose up redis -d

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –ª–æ–∫–∞–ª—å–Ω–æ
npm run start:dev

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
grpcurl -plaintext -d '{"query":"test","category":"3274"}' \
  localhost:3000 raw_product.RawProductService/GetRawProducts
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [NestJS Documentation](https://docs.nestjs.com/)
- [gRPC Documentation](https://grpc.io/docs/)
- [WildBerries API](https://developer.wildberries.ru/)
- [DEVELOPER_GUIDE.md](../../DEVELOPER_GUIDE.md)

---

**üéâ Happy Coding!** –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
