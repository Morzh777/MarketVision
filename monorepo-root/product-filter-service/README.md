# üîÄ Product-Filter-Service

## üì¶ –û–ø–∏—Å–∞–Ω–∏–µ

**Product-Filter-Service** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ö–∞–± —Å–∏—Å—Ç–µ–º—ã WBInfo –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —Å WildBerries –∏ Ozon. –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ HTTP API –¥–ª—è Telegram –±–æ—Ç–∞ –∏ –∫–∞–∫ gRPC-–∫–ª–∏–µ–Ω—Ç –∫ –ø–∞—Ä—Å–µ—Ä–∞–º.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Bot (Telegram/HTTP) ‚Üí Product-Filter-Service (HTTP API) ‚Üí WB API (gRPC) + Ozon API (gRPC)
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **ProductsService** ‚Äî –ª–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **RedisService** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø
- **gRPC-–∫–ª–∏–µ–Ω—Ç—ã** ‚Äî —Å–≤—è–∑—å —Å WB –∏ Ozon API
- **PhotoService** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **PriceStatisticsService** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–Ω
- **Validators** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run start:dev

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–µ
npm run build
npm run start:prod
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
REDIS_URL=redis://localhost:6379
WB_API_URL=localhost:3000
OZON_API_URL=localhost:3002
LOG_LEVEL=info
PORT=3001
```

## üì° HTTP API Endpoints

### –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
```http
POST /products/search
Content-Type: application/json

{
  "category": "videocards",
  "queries": ["rtx 5070", "rtx 5080", "rtx 5090"]
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–Ω
```http
GET /price-statistics/daily-summary/2024-01-15
GET /price-statistics/weekly-report/2024-W03
GET /price-statistics/market-insights
GET /price-statistics/bot-reports
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
```http
GET /health
```

## üß© –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ:
- **videocards** - –í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã (RTX 5070, RTX 5080, RTX 5090)
- **processors** - –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã (7800X3D, 9800X3D, 9950X3D)
- **motherboards** - –ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–µ –ø–ª–∞—Ç—ã (Z790, B760, X870E, B850)

### –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å–æ–ª–∏:
- **playstation** - PlayStation 5 (PS5, PS5 Slim)
- **playstation_accessories** - –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã PS5 (DualSense, PS5 Headset)
- **nintendo_switch** - Nintendo Switch (Switch 2, Switch OLED)

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Framework**: NestJS (TypeScript)
- **gRPC**: @grpc/grpc-js, @grpc/proto-loader
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: class-validator, class-transformer
- **HTTP Client**: node-fetch

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.ts                           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ app.module.ts                     # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ controllers/                      # HTTP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ products.controller.ts       # API —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ price-statistics.controller.ts # API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ services/                         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ products.service.ts          # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ redis.service.ts             # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ photo.service.ts             # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ
‚îÇ   ‚îî‚îÄ‚îÄ price-statistics.service.ts  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–Ω
‚îú‚îÄ‚îÄ grpc-clients/                     # gRPC –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ wb-api.client.ts             # –ö–ª–∏–µ–Ω—Ç WB API
‚îÇ   ‚îî‚îÄ‚îÄ ozon-api.client.ts           # –ö–ª–∏–µ–Ω—Ç Ozon API
‚îú‚îÄ‚îÄ validators/                       # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ videocard.validator.ts       # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç
‚îÇ   ‚îú‚îÄ‚îÄ processors.validator.ts      # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ playstation.validator.ts     # –í–∞–ª–∏–¥–∞—Ü–∏—è PS5
‚îÇ   ‚îî‚îÄ‚îÄ validator.factory.ts         # –§–∞–±—Ä–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ config/                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ categories.config.ts         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ queries.config.ts            # –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ interfaces/                       # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ grpc.interfaces.ts           # gRPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îî‚îÄ‚îÄ utils/                           # –£—Ç–∏–ª–∏—Ç—ã
    ‚îî‚îÄ‚îÄ logger.ts                    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
npm run test

# –¢–µ—Å—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
npm run test:statistics

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
npm run test:extended

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

- **–õ–æ–≥–∏**: –í—Å–µ –ª–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ –ø–∞–ø–∫—É `logs/`
- **–ú–µ—Ç—Ä–∏–∫–∏**: –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∫—ç—à hits/misses, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–Ω
- **Health Check**: `GET /health`

## üõ†Ô∏è gRPC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: `proto/raw-product.proto`
- **–ö–ª–∏–µ–Ω—Ç—ã**: WB API (–ø–æ—Ä—Ç 3000), Ozon API (–ø–æ—Ä—Ç 3002)
- **–ú–µ—Ç–æ–¥—ã**: GetRawProducts, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Proto —Ñ–∞–π–ª—ã
- –ü—É—Ç—å –∫ proto —Ñ–∞–π–ª–∞–º: `process.cwd() + 'proto/raw-product.proto'`
- –†–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ dev/prod —Ä–µ–∂–∏–º–∞—Ö
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ dist/

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Redis** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–Ω –∏ –∏—Å—Ç–æ—Ä–∏–∏
- **TTL** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
- **–ö–ª—é—á–∏**: `price:{category}:{id}`, `posted:{category}:{id}`

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–æ–≤
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

## ‚ùì FAQ / –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏

**Q: –û—à–∏–±–∫–∞ ENOENT: no such file or directory, open '.../proto/raw-product.proto'**
- A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ proto-—Ñ–∞–π–ª –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ `proto/` –≤ –∫–æ—Ä–Ω–µ —Å–µ—Ä–≤–∏—Å–∞

**Q: gRPC –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WB/Ozon API**
- A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `WB_API_URL` –∏ `OZON_API_URL`

**Q: Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è**
- A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `REDIS_URL` –∏ —á—Ç–æ Redis-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
npm run start:dev

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–µ
npm run build
npm run start:prod

# –¢–µ—Å—Ç—ã
npm run test:all

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
node check-redis.ts

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
node view-logs.js
```

---

**Product-Filter-Service** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ö–∞–± –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å WildBerries –∏ Ozon! üöÄ
